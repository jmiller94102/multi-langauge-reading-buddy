<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parameter Processing Test</title>
    <style>
        body {
            font-family: 'Inter', system-ui, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .test-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .control-group label {
            font-weight: 500;
            color: #e0e0e0;
        }
        .control-group input, .control-group select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 14px;
        }
        .control-group input[type="range"] {
            background: transparent;
        }
        .test-button {
            background: linear-gradient(45deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }
        .results {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .story-output {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
            line-height: 1.6;
            border-left: 4px solid #6366f1;
        }
        .korean-text {
            color: #fbbf24;
            font-weight: 500;
        }
        .word-count {
            text-align: right;
            color: #10b981;
            font-weight: 600;
            margin-top: 10px;
        }
        h1, h2 {
            color: #f8fafc;
            text-align: center;
        }
        .test-preset {
            display: inline-block;
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid #6366f1;
            border-radius: 6px;
            padding: 6px 12px;
            margin: 3px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        .test-preset:hover {
            background: rgba(99, 102, 241, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Parameter Processing Test Suite</h1>
        <p style="text-align: center; color: #e0e0e0;">
            Test that all user inputs are properly considered by the LLM parameter processing system
        </p>

        <div class="test-section">
            <h2>üìè Story Generation Parameters</h2>
            <div class="test-controls">
                <div class="control-group">
                    <label>Passage Length (words)</label>
                    <input type="number" id="passageLength" value="2000" min="250" max="2000" step="50">
                    <small>Target: <span id="lengthDisplay">2000</span> words (¬±10% = <span id="toleranceDisplay">1800-2200</span>)</small>
                </div>

                <div class="control-group">
                    <label>Theme/Subject</label>
                    <select id="passageTheme">
                        <option value="space">Space Adventure</option>
                        <option value="Pokemon">Pokemon Adventure</option>
                        <option value="basketball">Basketball Champions</option>
                        <option value="jungle">Jungle Exploration</option>
                        <option value="underwater">Ocean Discovery</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Humor Level</label>
                    <select id="humorLevel">
                        <option value="Low Fun">Low Fun (Educational)</option>
                        <option value="Moderate Fun">Moderate Fun (Balanced)</option>
                        <option value="High Fun">High Fun (Playful)</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Grade Level</label>
                    <select id="gradeLevel">
                        <option value="3rd">3rd Grade</option>
                        <option value="4th">4th Grade</option>
                        <option value="5th">5th Grade</option>
                        <option value="6th">6th Grade</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Korean Blend Level: <span id="koreanDisplay">5</span>/10</label>
                    <input type="range" id="koreanLevel" value="5" min="0" max="10" step="1">
                    <small>0=English only, 10=Heavy Korean</small>
                </div>
            </div>

            <div style="margin: 20px 0;">
                <strong>Quick Test Presets:</strong><br>
                <span class="test-preset" onclick="setPreset('short', 500, 'Low Fun', '3rd', 2)">üìñ Short & Simple</span>
                <span class="test-preset" onclick="setPreset('medium', 1000, 'Moderate Fun', '4th', 5)">üìö Medium Balanced</span>
                <span class="test-preset" onclick="setPreset('long', 2000, 'High Fun', '6th', 8)">üìù Long & Advanced</span>
                <span class="test-preset" onclick="setPreset('korean', 800, 'Moderate Fun', '5th', 10)">üá∞üá∑ Korean Heavy</span>
            </div>

            <button class="test-button" onclick="generateStory()">üéØ Generate Story</button>
            <button class="test-button" onclick="runAllTests()">üîÑ Run All Parameter Tests</button>
            <button class="test-button" onclick="clearResults()">üóëÔ∏è Clear Results</button>
        </div>

        <div class="test-section" id="resultsSection" style="display: none;">
            <h2>üìä Test Results</h2>
            <div id="testResults" class="results"></div>
            <div id="storyOutput" class="story-output" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Import the Azure OpenAI service (simulated for testing)
        class TestAzureOpenAIService {
            constructor() {
                console.log('üß™ Test Azure OpenAI Service initialized')
            }

            // Simulate the actual service method
            async generateStoryPassage(params) {
                console.log('üìã Generating story with parameters:')
                console.log('   üìè Target Length:', params.passageLength, 'words')
                console.log('   üé≠ Humor Level:', params.humorLevel)
                console.log('   üéì Grade Level:', params.gradeLevel)
                console.log('   üá∞üá∑ Korean Level:', params.koreanLevel + '/10')
                console.log('   üé® Theme:', params.passageTheme)

                // Simulate parameter processing
                const baseStory = this.generateStoryContent(params)
                const koreanBlendedStory = this.applyKoreanBlending(baseStory, params.koreanLevel)
                const lengthAdjustedStory = this.adjustStoryLength(koreanBlendedStory, params.passageLength)
                const humorAdjustedStory = this.applyHumorLevel(lengthAdjustedStory, params.humorLevel)
                const gradeAdjustedStory = this.adjustForGradeLevel(humorAdjustedStory, params.gradeLevel)

                return {
                    title: `${params.passageTheme} Adventure - Korean Level ${params.koreanLevel}`,
                    content: gradeAdjustedStory,
                    wordCount: gradeAdjustedStory.split(' ').length,
                    gradeLevel: params.gradeLevel,
                    koreanLevel: params.koreanLevel
                }
            }

            generateStoryContent(params) {
                const stories = {
                    space: "Welcome to an exciting space adventure! Our brave astronaut explorer sets out on a wonderful journey through the cosmos filled with discovery and mystery. The story begins when our hero steps into a magical spaceship portal. Everything around sparkles with beautiful stellar energy and cosmic wonder. Among the twinkling stars and swirling galaxies, amazing discoveries await. Through trials and challenges, courage and friendship guide the way forward.",
                    Pokemon: "Welcome to an exciting Pokemon adventure! Our brave Pokemon trainer sets out on a wonderful journey filled with discovery and mystery. The story begins when our hero steps into a magical Pokemon center portal. Everything around sparkles with beautiful Pokemon energy and wonder. Among the grass and forests, amazing Pokemon discoveries await. Through battles and challenges, courage and friendship guide the way forward.",
                    basketball: "Welcome to an exciting basketball adventure! Our brave basketball player sets out on a wonderful journey filled with discovery and mystery on the court. The story begins when our hero steps into a magical gymnasium portal. Everything around sparkles with beautiful athletic energy and wonder. Among the hoops and courts, amazing basketball discoveries await. Through games and challenges, courage and teamwork guide the way forward.",
                    jungle: "Welcome to an exciting jungle adventure! Our brave explorer sets out on a wonderful journey through the rainforest filled with discovery and mystery. The story begins when our hero steps into a magical jungle portal. Everything around sparkles with beautiful natural energy and wonder. Among the trees and vines, amazing jungle discoveries await. Through trials and challenges, courage and friendship guide the way forward.",
                    underwater: "Welcome to an exciting underwater adventure! Our brave diver sets out on a wonderful journey through the ocean depths filled with discovery and mystery. The story begins when our hero steps into a magical underwater portal. Everything around sparkles with beautiful aquatic energy and wonder. Among the coral reefs and sea creatures, amazing ocean discoveries await. Through currents and challenges, courage and friendship guide the way forward."
                }
                return stories[params.passageTheme] || stories.space
            }

            applyKoreanBlending(story, koreanLevel) {
                const koreanWords = {
                    level1: [
                        { en: 'adventure', ko: 'Î™®Ìóò', romanized: 'moheom' },
                        { en: 'friend', ko: 'ÏπúÍµ¨', romanized: 'chingu' },
                        { en: 'story', ko: 'Ïù¥ÏïºÍ∏∞', romanized: 'iyagi' },
                        { en: 'journey', ko: 'Ïó¨Ìñâ', romanized: 'yeohaeng' }
                    ],
                    level2: [
                        { en: 'beautiful', ko: 'ÏïÑÎ¶ÑÎã§Ïö¥', romanized: 'areumdaun' },
                        { en: 'exciting', ko: 'Ïã†ÎÇòÎäî', romanized: 'sinnaneun' },
                        { en: 'wonderful', ko: 'Î©ãÏßÑ', romanized: 'meotjin' },
                        { en: 'discovery', ko: 'Î∞úÍ≤¨', romanized: 'balgyeon' }
                    ]
                }

                let blendedStory = story

                if (koreanLevel >= 1 && koreanLevel <= 3) {
                    koreanWords.level1.forEach(word => {
                        const regex = new RegExp(`\\b${word.en}\\b`, 'gi')
                        blendedStory = blendedStory.replace(regex, `${word.en} (${word.ko})`)
                    })
                }

                if (koreanLevel >= 4 && koreanLevel <= 6) {
                    koreanWords.level1.forEach(word => {
                        const regex = new RegExp(`\\b${word.en}\\b`, 'gi')
                        blendedStory = blendedStory.replace(regex, `${word.ko} (${word.en})`)
                    })
                    koreanWords.level2.forEach(word => {
                        const regex = new RegExp(`\\b${word.en}\\b`, 'gi')
                        blendedStory = blendedStory.replace(regex, `${word.en} (${word.ko})`)
                    })
                }

                if (koreanLevel >= 7 && koreanLevel <= 9) {
                    koreanWords.level1.forEach(word => {
                        const regex = new RegExp(`\\b${word.en}\\b`, 'gi')
                        blendedStory = blendedStory.replace(regex, word.ko)
                    })
                    koreanWords.level2.forEach(word => {
                        const regex = new RegExp(`\\b${word.en}\\b`, 'gi')
                        blendedStory = blendedStory.replace(regex, `${word.ko} (${word.en})`)
                    })
                }

                if (koreanLevel === 10) {
                    blendedStory = 'ÏïàÎÖïÌïòÏÑ∏Ïöî! (Hello!) ' + blendedStory
                    koreanWords.level1.forEach(word => {
                        const regex = new RegExp(`\\b${word.en}\\b`, 'gi')
                        blendedStory = blendedStory.replace(regex, word.ko)
                    })
                    koreanWords.level2.forEach(word => {
                        const regex = new RegExp(`\\b${word.en}\\b`, 'gi')
                        blendedStory = blendedStory.replace(regex, word.ko)
                    })
                }

                console.log(`üá∞üá∑ Applied Korean blending level ${koreanLevel}/10`)
                return blendedStory
            }

            adjustStoryLength(story, targetLength) {
                const currentWords = story.split(' ').length
                const tolerance = Math.round(targetLength * 0.1)

                console.log(`üìè Current length: ${currentWords} words, target: ${targetLength} (¬±${tolerance})`)

                if (currentWords < targetLength - tolerance) {
                    const expansions = [
                        ' The characters discovered new challenges that tested their resolve and determination.',
                        ' Along the way, they met helpful companions who shared valuable wisdom and guidance.',
                        ' The landscape around them was filled with breathtaking sights and mysterious sounds.',
                        ' Each step of their path revealed new lessons about courage, friendship, and perseverance.',
                        ' The adventure taught them important values about working together and never giving up.',
                        ' Through their experiences, they gained confidence and learned to trust in their abilities.',
                        ' The world around them was alive with wonder, magic, and endless possibilities for growth.',
                        ' Their journey showed them that the greatest treasures are the memories and friendships made along the way.'
                    ]

                    let expandedStory = story
                    let wordsAdded = 0
                    const wordsNeeded = targetLength - currentWords

                    while (wordsAdded < wordsNeeded && expansions.length > 0) {
                        const expansion = expansions.splice(Math.floor(Math.random() * expansions.length), 1)[0]
                        expandedStory += expansion
                        wordsAdded += expansion.split(' ').length
                    }

                    console.log(`üìà Expanded story by ${wordsAdded} words`)
                    return expandedStory
                } else if (currentWords > targetLength + tolerance) {
                    const words = story.split(' ')
                    const trimmedWords = words.slice(0, targetLength)
                    const trimmedStory = trimmedWords.join(' ')

                    console.log(`üìâ Trimmed story by ${currentWords - targetLength} words`)
                    return trimmedStory
                }

                return story
            }

            applyHumorLevel(story, humorLevel) {
                if (humorLevel === 'Low Fun') {
                    return story.replace(/exciting/g, 'interesting').replace(/amazing/g, 'remarkable')
                } else if (humorLevel === 'High Fun') {
                    let funStory = story
                    funStory = funStory.replace(/sets out/g, 'skips merrily out')
                    funStory = funStory.replace(/begins/g, 'hilariously begins')
                    funStory = funStory.replace(/steps/g, 'bounces playfully')
                    funStory += ' And everyone couldn\'t help but smile and laugh at the wonderfully silly adventures they shared!'
                    console.log(`üòÑ Applied HIGH humor level`)
                    return funStory
                }

                console.log(`üòä Applied MODERATE humor level`)
                return story.replace(/discovered/g, 'joyfully discovered').replace(/wonderful/g, 'delightfully wonderful')
            }

            adjustForGradeLevel(story, gradeLevel) {
                const grade = parseInt(gradeLevel.charAt(0))

                if (grade <= 3) {
                    let simpleStory = story
                    simpleStory = simpleStory.replace(/magnificent/g, 'amazing')
                    simpleStory = simpleStory.replace(/extraordinary/g, 'wonderful')
                    simpleStory = simpleStory.replace(/perseverance/g, 'trying hard')
                    simpleStory = simpleStory.replace(/companions/g, 'friends')
                    console.log(`üìö Adjusted vocabulary for ${gradeLevel} (simpler words)`)
                    return simpleStory
                } else if (grade >= 5) {
                    let advancedStory = story
                    advancedStory = advancedStory.replace(/amazing/g, 'magnificent')
                    advancedStory = advancedStory.replace(/wonderful/g, 'extraordinary')
                    advancedStory = advancedStory.replace(/trying hard/g, 'demonstrating perseverance')
                    console.log(`üìö Adjusted vocabulary for ${gradeLevel} (advanced words)`)
                    return advancedStory
                }

                console.log(`üìö Story appropriate for ${gradeLevel}`)
                return story
            }
        }

        // Initialize test service
        const testService = new TestAzureOpenAIService()

        // UI update functions
        function updateDisplays() {
            const length = document.getElementById('passageLength').value
            const tolerance = Math.round(length * 0.1)
            document.getElementById('lengthDisplay').textContent = length
            document.getElementById('toleranceDisplay').textContent = `${length - tolerance}-${parseInt(length) + tolerance}`
            document.getElementById('koreanDisplay').textContent = document.getElementById('koreanLevel').value
        }

        function setPreset(name, length, humor, grade, korean) {
            document.getElementById('passageLength').value = length
            document.getElementById('humorLevel').value = humor
            document.getElementById('gradeLevel').value = grade
            document.getElementById('koreanLevel').value = korean
            updateDisplays()
        }

        function showResults() {
            document.getElementById('resultsSection').style.display = 'block'
        }

        function clearResults() {
            document.getElementById('testResults').textContent = ''
            document.getElementById('storyOutput').style.display = 'none'
            document.getElementById('resultsSection').style.display = 'none'
        }

        function logResult(message) {
            const results = document.getElementById('testResults')
            results.textContent += message + '\n'
            showResults()
        }

        async function generateStory() {
            const params = {
                passageLength: parseInt(document.getElementById('passageLength').value),
                passageTheme: document.getElementById('passageTheme').value,
                humorLevel: document.getElementById('humorLevel').value,
                gradeLevel: document.getElementById('gradeLevel').value,
                koreanLevel: parseInt(document.getElementById('koreanLevel').value)
            }

            logResult(`\nüéØ TESTING STORY GENERATION`)
            logResult(`üìã Parameters: Length=${params.passageLength}, Theme=${params.passageTheme}, Humor=${params.humorLevel}, Grade=${params.gradeLevel}, Korean=${params.koreanLevel}/10`)

            try {
                const result = await testService.generateStoryPassage(params)

                // Validate results
                const tolerance = Math.round(params.passageLength * 0.1)
                const targetMin = params.passageLength - tolerance
                const targetMax = params.passageLength + tolerance
                const actualLength = result.wordCount

                logResult(`‚úÖ Story Generated Successfully!`)
                logResult(`üìè Word Count: ${actualLength} (target: ${params.passageLength} ¬±${tolerance})`)

                if (actualLength >= targetMin && actualLength <= targetMax) {
                    logResult(`‚úÖ LENGTH TEST PASSED: Within tolerance`)
                } else {
                    logResult(`‚ùå LENGTH TEST FAILED: Outside tolerance range`)
                }

                // Check Korean blending
                const hasKorean = result.content.includes('(') && result.content.includes(')')
                const hasHangul = /[\u3131-\u3163\u3AC0-\u3D7F]/.test(result.content)

                if (params.koreanLevel > 0) {
                    if (hasKorean || hasHangul) {
                        logResult(`‚úÖ KOREAN BLEND TEST PASSED: Korean elements detected`)
                    } else {
                        logResult(`‚ùå KOREAN BLEND TEST FAILED: No Korean elements found`)
                    }
                } else {
                    logResult(`‚ÑπÔ∏è KOREAN BLEND: Level 0 - English only (expected)`)
                }

                // Check humor level
                const isPlayful = result.content.includes('hilariously') || result.content.includes('merrily') || result.content.includes('smile and laugh')
                const isEducational = result.content.includes('interesting') || result.content.includes('remarkable')

                if (params.humorLevel === 'High Fun' && isPlayful) {
                    logResult(`‚úÖ HUMOR TEST PASSED: High fun elements detected`)
                } else if (params.humorLevel === 'Low Fun' && isEducational) {
                    logResult(`‚úÖ HUMOR TEST PASSED: Educational tone detected`)
                } else {
                    logResult(`‚ÑπÔ∏è HUMOR TEST: ${params.humorLevel} applied`)
                }

                // Display story
                const storyOutput = document.getElementById('storyOutput')
                storyOutput.innerHTML = `
                    <h3>${result.title}</h3>
                    <div class="story-content">${result.content.replace(/\((.*?)\)/g, '<span class="korean-text">($1)</span>')}</div>
                    <div class="word-count">Word Count: ${result.wordCount}</div>
                `
                storyOutput.style.display = 'block'

            } catch (error) {
                logResult(`‚ùå ERROR: ${error.message}`)
            }
        }

        async function runAllTests() {
            logResult(`\nüîÑ RUNNING COMPREHENSIVE PARAMETER TESTS\n`)

            const testCases = [
                { name: 'Short Simple', length: 500, humor: 'Low Fun', grade: '3rd', korean: 2 },
                { name: 'Medium Balanced', length: 1000, humor: 'Moderate Fun', grade: '4th', korean: 5 },
                { name: 'Long Advanced', length: 2000, humor: 'High Fun', grade: '6th', korean: 8 },
                { name: 'Korean Heavy', length: 800, humor: 'Moderate Fun', grade: '5th', korean: 10 },
                { name: 'English Only', length: 1200, humor: 'High Fun', grade: '4th', korean: 0 }
            ]

            for (const testCase of testCases) {
                logResult(`\nüìù Testing: ${testCase.name}`)

                // Set parameters
                document.getElementById('passageLength').value = testCase.length
                document.getElementById('humorLevel').value = testCase.humor
                document.getElementById('gradeLevel').value = testCase.grade
                document.getElementById('koreanLevel').value = testCase.korean
                updateDisplays()

                // Generate and test
                await generateStory()

                // Brief pause between tests
                await new Promise(resolve => setTimeout(resolve, 500))
            }

            logResult(`\nüéâ ALL PARAMETER TESTS COMPLETED!`)
        }

        // Initialize displays
        document.getElementById('passageLength').addEventListener('input', updateDisplays)
        document.getElementById('koreanLevel').addEventListener('input', updateDisplays)
        updateDisplays()
    </script>
</body>
</html>